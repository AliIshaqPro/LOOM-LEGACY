 <!DOCTYPE html>
<html>
<head>
 <%= stylesheet_link_tag 'whatsapp', media: 'all', 'data-turbolinks-track': 'reload' %>
 <%= stylesheet_link_tag 'form', media: 'all', 'data-turbolinks-track': 'reload' %>
 <style>
body {
    margin: 0;
    padding: 0;
    background-image: url('https://images.unsplash.com/photo-1595418917831-ef942bd9f9ec?q=80&w=1470&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D');
    background-attachment: fixed;
    background-size: cover; /* Optional: Ensures the image covers the entire viewport */
    background-position: center; /* Optional: Centers the image in the viewport */
}
  </style>
 </head>
<body>
<div class="d-grid gap-2">
      <button class="btn btn-primary" type="button" data-bs-toggle="offcanvas"
        data-bs-target="#offcanvasScrolling" aria-controls="offcanvasScrolling">
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
          fill="currentColor" class="bi bi-person-plus-fill"
          viewBox="0 0 16 16">
          <path
            d="M1 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6" />
          <path fill-rule="evenodd"
            d="M13.5 5a.5.5 0 0 1 .5.5V7h1.5a.5.5 0 0 1 0 1H14v1.5a.5.5 0 0 1-1 0V8h-1.5a.5.5 0 0 1 0-1H13V5.5a.5.5 0 0 1 .5-.5" />
        </svg> Select a New Contact</button>
    </div>
<div style="padding-bottom: 100px;">
    <% @conversations.each do |conversation| %>
      <% most_recent_message = conversation.messages.order(created_at: :desc).first %>
      <%= link_to conversation_path(conversation), class: 'list-group-item list-group-item-action border border-secondary py-2 mb-1 mt-1', style: 'background-color: rgba(255, 255, 255, 0.1); z-index:0; border-radius:20px;' do %>
        <% other_user = conversation.other_user(current_user) %>
        <% if other_user.photo.attached? %>
          <%= image_tag other_user.photo.variant(resize_to_fill: [50, 50]), alt: other_user.username, class: 'rounded-circle' %>
        <% else %>
          <%= image_tag 'ali.JPG', alt: 'Ali', width: 50, height: 50, class: 'rounded-circle' %>
        <% end %>
        <div class="info">
          <h5 class="mb-1" style="color:white;"><b><%= other_user.username %></b></h5>
          <p style="font-size: 0.75rem; color: Black; margin: 0;">
            <% if most_recent_message.present? %>
              <p style="color:white;"><%= truncate(most_recent_message.content, length: 30) %></p>
            <% else %>
              <span style="font-size: 0.75rem; color: white;">- - - - - No- - - - - </span>
            <% end %>
          </p>
        </div>
        <small class="text-body-secondary">
          <% if most_recent_message.present? %>
            <p style="font-size:15px; color:white;"><%= most_recent_message.created_at.strftime('%I:%M:%S %p') %></p>
          <% else %>
            <span style="font-size: 0.75rem; color: #666;">- - - - - - - - - - </span>
          <% end %>
        </small>
      <% end %>
    <% end %>
  </div>  
  
    <nav class="navbar">
      
      <h3 class="navbar-title">CHATSPHERE</h3>
      <div class="navbar-icons">
        <button id="close-btn" onclick="closeCamera()" aria-label="Close Camera"
          style="display: none; position: absolute; top: 10px; left: 10px;">Close</button>
        <a href="javascript:void(0);" onclick="openCamera()"
          aria-label="Camera">
          <div style="position: relative; width: 100%; height: auto;">

            <video id="camera-stream" autoplay
              style="width: 100%; height: auto; display: none;"></video>
          </div>
          <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32"
            fill="currentColor" class="bi bi-camera" viewBox="0 0 16 16">
            <path
              d="M15 12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h1.172a3 3 0 0 0 2.12-.879l.83-.828A1 1 0 0 1 6.827 3h2.344a1 1 0 0 1 .707.293l.828.828A3 3 0 0 0 12.828 5H14a1 1 0 0 1 1 1zM2 4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2h-1.172a2 2 0 0 1-1.414-.586l-.828-.828A2 2 0 0 0 9.172 2H6.828a2 2 0 0 0-1.414.586l-.828.828A2 2 0 0 1 3.172 4z" />
            <path
              d="M8 11a2.5 2.5 0 1 1 0-5 2.5 2.5 0 0 1 0 5m0 1a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7M3 6.5a.5.5 0 1 1-1 0 .5.5 0 0 1 1 0" />
          </svg>
        </a>
        <button class="btn btn-primary" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasRight" aria-controls="offcanvasRight"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" class="dropdown-icon" viewBox="0 0 16 16">
        <path fill-rule="evenodd" d="M2 2.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5V3a.5.5 0 0 0-.5-.5zM3 3H2v1h1z"/>
        <path d="M5 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5M5.5 7a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1zm0 4a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1z"/>
        <path fill-rule="evenodd" d="M1.5 7a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5zM2 7h1v1H2zm0 3.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm1 .5H2v1h1z"/>
      </svg></button>

<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasRight" aria-labelledby="offcanvasRightLabel">
  <div class="offcanvas-header">
    <h5 class="offcanvas-title" id="offcanvasRightLabel">Setting</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body">
  <button class="btn btn-primary w-100" type="button">Button</button>
  <button class="btn btn-primary w-100" type="button">Button</button>
  
  <!-- Logout button -->
  <%= button_to 'Logout', destroy_user_session_path, method: :delete, class: "btn btn-primary w-100" %>
  
  <!-- Edit Profile button styled as a button using link_to -->
  <%= link_to 'Edit Profile', edit_user_registration_path, class: "btn btn-primary w-100" %>
  </div>
</div>
        
           </ul>
        </div>
      </div>
    </nav>
    
    

<footer class="footer">
<div class="footer-icons">
  <a href="#" target="_blank"
    aria-label="Facebook">
    <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30"
      fill="currentColor" class="bi bi-chat-right-text"
      viewBox="0 0 16 16">
      <path
        d="M2 1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h9.586a2 2 0 0 1 1.414.586l2 2V2a1 1 0 0 0-1-1zm12-1a2 2 0 0 1 2 2v12.793a.5.5 0 0 1-.854.353l-2.853-2.853a1 1 0 0 0-.707-.293H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2z" />
      <path
        d="M3 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5M3 6a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9A.5.5 0 0 1 3 6m0 2.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5" />
    </svg>
    <span>Chats</span>
  </a>
  <a href="#" target="_blank"
    aria-label="Facebook">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16"
      fill="currentColor" class="bi bi-chat-quote" viewBox="0 0 16 16">
      <path
        d="M2.678 11.894a1 1 0 0 1 .287.801 11 11 0 0 1-.398 2c1.395-.323 2.247-.697 2.634-.893a1 1 0 0 1 .71-.074A8 8 0 0 0 8 14c3.996 0 7-2.807 7-6s-3.004-6-7-6-7 2.808-7 6c0 1.468.617 2.83 1.678 3.894m-.493 3.905a22 22 0 0 1-.713.129c-.2.032-.352-.176-.273-.362a10 10 0 0 0 .244-.637l.003-.01c.248-.72.45-1.548.524-2.319C.743 11.37 0 9.76 0 8c0-3.866 3.582-7 8-7s8 3.134 8 7-3.582 7-8 7a9 9 0 0 1-2.347-.306c-.52.263-1.639.742-3.468 1.105" />
      <path
        d="M7.066 6.76A1.665 1.665 0 0 0 4 7.668a1.667 1.667 0 0 0 2.561 1.406c-.131.389-.375.804-.777 1.22a.417.417 0 0 0 .6.58c1.486-1.54 1.293-3.214.682-4.112zm4 0A1.665 1.665 0 0 0 8 7.668a1.667 1.667 0 0 0 2.561 1.406c-.131.389-.375.804-.777 1.22a.417.417 0 0 0 .6.58c1.486-1.54 1.293-3.214.682-4.112z" />
    </svg>
    <span>Updates</span>
  </a>
  <a href="#" target="_blank"
    aria-label="Facebook">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-people" viewBox="0 0 16 16">
<path d="M15 14s1 0 1-1-1-4-5-4-5 3-5 4 1 1 1 1zm-7.978-1L7 12.996c.001-.264.167-1.03.76-1.72C8.312 10.629 9.282 10 11 10c1.717 0 2.687.63 3.24 1.276.593.69.758 1.457.76 1.72l-.008.002-.014.002zM11 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4m3-2a3 3 0 1 1-6 0 3 3 0 0 1 6 0M6.936 9.28a6 6 0 0 0-1.23-.247A7 7 0 0 0 5 9c-4 0-5 3-5 4q0 1 1 1h4.216A2.24 2.24 0 0 1 5 13c0-1.01.377-2.042 1.09-2.904.243-.294.526-.569.846-.816M4.92 10A5.5 5.5 0 0 0 4 13H1c0-.26.164-1.03.76-1.724.545-.636 1.492-1.256 3.16-1.275ZM1.5 5.5a3 3 0 1 1 6 0 3 3 0 0 1-6 0m3-2a2 2 0 1 0 0 4 2 2 0 0 0 0-4"/>
</svg>
    <span>Communities</span>
  </a>
  <a href="" target="_blank"
    aria-label="Facebook">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-telephone-outbound" viewBox="0 0 16 16">
<path d="M3.654 1.328a.678.678 0 0 0-1.015-.063L1.605 2.3c-.483.484-.661 1.169-.45 1.77a17.6 17.6 0 0 0 4.168 6.608 17.6 17.6 0 0 0 6.608 4.168c.601.211 1.286.033 1.77-.45l1.034-1.034a.678.678 0 0 0-.063-1.015l-2.307-1.794a.68.68 0 0 0-.58-.122l-2.19.547a1.75 1.75 0 0 1-1.657-.459L5.482 8.062a1.75 1.75 0 0 1-.46-1.657l.548-2.19a.68.68 0 0 0-.122-.58zM1.884.511a1.745 1.745 0 0 1 2.612.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.68.68 0 0 0 .178.643l2.457 2.457a.68.68 0 0 0 .644.178l2.189-.547a1.75 1.75 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.6 18.6 0 0 1-7.01-4.42 18.6 18.6 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877zM11 .5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 .5.5v4a.5.5 0 0 1-1 0V1.707l-4.146 4.147a.5.5 0 0 1-.708-.708L14.293 1H11.5a.5.5 0 0 1-.5-.5"/>
</svg>
    <span>Calls</span>
  </a>
</div>
</footer>
    <div class="offcanvas offcanvas-start" data-bs-scroll="true"
      data-bs-backdrop="false" tabindex="-1" id="offcanvasScrolling"
      aria-labelledby="offcanvasScrollingLabel">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasScrollingLabel">CHATSPHERE</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas"
          aria-label="Close"></button>
      </div>
      

      <div class="offcanvas-body">

      <% if user_signed_in? %>
        <%= form_with(model: @conversation, url: conversations_path, local: true) do |f| %>
          <%= f.label :phone_number, "Select User by Phone Number" %>
          <%= f.collection_select :phone_number, @users, :phone_number, :phone_number, include_blank: "Select a Phone Number" %>
          <%= f.submit "Start Chat", class: "btn btn-primary" %>
        <% end %>
      <% else %>
        <%= link_to 'Sign Up', new_user_registration_path %>
        <%= link_to 'Login', new_user_session_path %>
      <% end %>
    
      <div>
        <div class="list-group">
          <ul style="list-style: none; padding-left: 0; margin-left: 0;">
            <% @conversations.each do |conversation| %>
              <% most_recent_message = conversation.messages.order(created_at: :desc).first %>
              <%= link_to conversation_path(conversation), class: 'list-group-item list-group-item-action' do %>
                <% other_user = conversation.other_user(current_user) %>
                <% if other_user.photo.attached? %>
                  <%= image_tag other_user.photo.variant(resize_to_fill: [50, 50]), alt: other_user.username, class: 'rounded-circle' %>
                <% else %>
                  <%= image_tag 'ali.JPG', alt: 'Ali', width: 50, height: 50, class: 'rounded-circle' %>
                <% end %>
                <div class="info">
                  <h5 class="mb-1"><b><%= other_user.username %></b></h5>
                  <p style="font-size: 0.75rem; color: #666; margin: 0;">
                    <% if most_recent_message.present? %>
                      <%= truncate(most_recent_message.content, length: 100) %>
                    <% else %>
                      <span style="font-size: 0.75rem; color: #666;">- - - - - - - - - - </span>
                    <% end %>
                  </p>
                </div>
                <small class="text-body-secondary">
                  <% if most_recent_message.present? %>
                    <%= most_recent_message.created_at.strftime('%I:%M:%S %p') %>
                  <% else %>
                    <span style="font-size: 0.75rem; color: #666;">- - - - - - - - - - </span>
                  <% end %>
                </small>
              <% end %>
            <% end %>
          </ul>
        </div>
      </div>
    
    </div>
  
  <script
    src="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
  <script>
  document.addEventListener('DOMContentLoaded', function() {
  const dropdownToggle = document.getElementById('dropdownToggle');
  const dropdownMenu = document.getElementById('dropdownMenu');
  
  dropdownToggle.addEventListener('click', function(event) {
  event.stopPropagation(); // Prevent click event from closing the dropdown immediately
  const isVisible = dropdownMenu.style.display === 'block';
  dropdownMenu.style.display = isVisible ? 'none' : 'block';
  adjustDropdownPosition();
  });
  
  document.addEventListener('click', function(event) {
  if (!dropdownToggle.contains(event.target) && !dropdownMenu.contains(event.target)) {
    dropdownMenu.style.display = 'none';
  }
  });
  
  function adjustDropdownPosition() {
  const rect = dropdownMenu.getBoundingClientRect();
  const isOverflowingLeft = rect.left < 0;
  const isOverflowingRight = rect.right > window.innerWidth;
  
  if (isOverflowingLeft) {
    dropdownMenu.style.left = '0'; // Reset position to keep it within screen
    dropdownMenu.style.right = '0'; // Align to the right edge of the dropdown container
  } else if (isOverflowingRight) {
    dropdownMenu.style.left = 'auto';
    dropdownMenu.style.right = '0'; // Ensure it stays within the right edge of the viewport
  } else {
    dropdownMenu.style.left = '0'; // Default positioning
    dropdownMenu.style.right = 'auto';
  }
  }
  });
  function openCamera() {
  navigator.mediaDevices.getUserMedia({ video: true })
  .then(function(stream) {
    const video = document.getElementById('camera-stream');
    const closeButton = document.getElementById('close-btn');
    video.style.display = 'block'; // Show the video element
    closeButton.style.display = 'block'; // Show the close button
    video.srcObject = stream; // Display the camera stream
  })
  .catch(function(err) {
    console.error("Error: " + err);
  });
  }
  
  function closeCamera() {
  const video = document.getElementById('camera-stream');
  const closeButton = document.getElementById('close-btn');
  const stream = video.srcObject;
  if (stream) {
  const tracks = stream.getTracks();
  tracks.forEach(track => track.stop());
  video.srcObject = null;
  video.style.display = 'none'; // Hide the video element
  closeButton.style.display = 'none'; // Hide the close button
  }
  }
  
  </script>
  </body>
</html>
